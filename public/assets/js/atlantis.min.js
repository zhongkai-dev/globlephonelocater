/**
 * Simplified Atlantis Admin Dashboard JS
 * Version: 1.0.0
 */

"use strict";

// Atlantis main initialization
var Atlantis = {
    init: function() {
        this.initComponents();
        this.initNavigation();
        this.initScrollBar();
    },
    
    initComponents: function() {
        // Initialize tooltips
        $('[data-toggle="tooltip"]').tooltip();
        
        // Initialize popovers
        $('[data-toggle="popover"]').popover({
            html: true,
            container: 'body'
        });
        
        // Initialize DataTables
        if ($('.datatable').length > 0) {
            $('.datatable').DataTable({
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
            });
        }
        
        if ($('.table').length > 0 && !$('.table').hasClass('dataTable')) {
            $('.table').DataTable({
                "pageLength": 10,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
            });
        }
        
        // Handle flash messages
        setTimeout(function() {
            $('.alert-dismissible').fadeOut('slow');
        }, 3000);
    },
    
    initNavigation: function() {
        // Toggle sidebar
        $('.sidenav-toggler').on('click', function() {
            $('body').toggleClass('sidebar-mini');
            
            if ($('body').hasClass('sidebar-mini')) {
                localStorage.setItem('sidebar-mini', true);
            } else {
                localStorage.removeItem('sidebar-mini');
            }
        });
        
        // Check sidebar state
        if (localStorage.getItem('sidebar-mini') === 'true') {
            $('body').addClass('sidebar-mini');
        }
        
        // Highlight active menu item
        var currentPath = window.location.pathname;
        $('.sidebar .nav .nav-item').each(function() {
            var link = $(this).find('.nav-link');
            var href = link.attr('href');
            
            // Check if already active (from server-side)
            if (!$(this).hasClass('active')) {
                // Match based on URL path
                if (href && currentPath.startsWith(href) && href !== '/') {
                    $(this).addClass('active');
                    $(this).find('.nav-link').addClass('active');
                }
            }
        });
    },
    
    initScrollBar: function() {
        // Simple scroll handling for modern browsers
        $('.sidebar').css('overflow-y', 'auto');
    },
    
    showNotification: function(message, type) {
        type = type || 'info';
        
        let icon = 'fas fa-info-circle';
        
        if (type === 'success') icon = 'fas fa-check-circle';
        if (type === 'warning') icon = 'fas fa-exclamation-circle';
        if (type === 'danger') icon = 'fas fa-times-circle';
        
        const html = `
            <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                <i class="${icon} mr-2"></i> ${message}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        `;
        
        // If notifications container exists, prepend to it
        if ($('#notifications').length) {
            $('#notifications').prepend(html);
        } else {
            // Create container if it doesn't exist
            if (!$('.notifications-container').length) {
                $('body').prepend('<div class="notifications-container" style="position:fixed; top:20px; right:20px; z-index:9999; width:300px;"></div>');
            }
            $('.notifications-container').prepend(html);
        }
        
        // Auto-dismiss after 3 seconds
        setTimeout(function() {
            $('.alert-dismissible').fadeOut('slow', function() {
                $(this).remove();
            });
        }, 3000);
    }
};

// Initialize when document is ready
$(document).ready(function() {
    Atlantis.init();
}); 